@model IEnumerable<PROG6212_POE.Models.Claim>
@{
    ViewData["Title"] = "Lecturer Dashboard";
}

<div class="container mt-4">
    <h1 class="mb-4 text-center">Lecturer Dashboard</h1>

    <div class="d-flex justify-content-center mb-4">
        <a asp-action="SubmitClaim" class="btn btn-success me-2">
            <i class="bi bi-plus-circle"></i> Submit New Claim
        </a>
        <a asp-action="TrackClaim" class="btn btn-secondary me-2">
            <i class="bi bi-card-list"></i> View Submitted Claims
        </a>
        <a asp-action="SelectClaimForUpload" class="btn btn-primary">
            <i class="bi bi-upload"></i> Upload Supporting Document
        </a>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success text-center">@TempData["SuccessMessage"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger text-center">@TempData["ErrorMessage"]</div>
    }

    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Claim ID</th>
                    <th>Lecturer</th>
                    <th>Month</th>
                    <th>Total Hours</th>
                    <th>Hourly Rate</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Supporting Documents</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var claim in Model)
                {
                    <tr>
                        <td>@claim.ClaimId</td>
                        <td>@claim.LecturerName</td>
                        <td>@claim.Month</td>
                        <td>@claim.TotalHours</td>
                        <td>R @claim.HourlyRate</td>
                        <td>R @claim.TotalAmount</td>
                        <td>
                            @switch (claim.Status)
                            {
                                case "Pending Verification":
                                    <span class="badge bg-warning">@claim.Status</span>
                                    break;
                                case "Verified":
                                    <span class="badge bg-info">@claim.Status</span>
                                    break;
                                case "Approved":
                                    <span class="badge bg-success">@claim.Status</span>
                                    break;
                                case "Rejected":
                                    <span class="badge bg-danger">@claim.Status</span>
                                    break;
                                default:
                                    <span class="badge bg-secondary">@claim.Status</span>
                                    break;
                            }
                        </td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar"
                                     style="width:@(claim.Status == "Pending Verification" ? 33 : (claim.Status == "Verified" ? 66 : (claim.Status == "Approved" ? 100 : (claim.Status == "Rejected" ? 100 : 0))))%;"
                                     class="@(claim.Status == "Rejected" ? "bg-danger" : (claim.Status == "Approved" ? "bg-success" : "bg-info"))">
                                    @claim.Status
                                </div>
                            </div>
                        </td>
                        <td>
                            @if (claim.SupportingDocuments != null && claim.SupportingDocuments.Any())
                            {
                                <ul class="mb-0">
                                    @foreach (var doc in claim.SupportingDocuments)
                                    {
                                        <li>
                                            <a href="@doc.FilePath" target="_blank">@doc.FileName</a>
                                        </li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <span class="text-muted">No documents</span>
                            }
                        </td>
                        <td style="min-width: 270px;">
                            <form asp-action="UploadDocuments" asp-route-claimId="@claim.ClaimId"
                                  method="post" enctype="multipart/form-data" class="d-flex gap-2">
                                <input type="file" name="supportingFile" class="form-control" />
                                <button type="submit" class="btn btn-primary">Upload</button>
                            </form>
                            @if (claim.SupportingDocuments != null && claim.SupportingDocuments.Any())
                            {
                                <small class="text-muted">Uploaded: @claim.SupportingDocuments.Count()</small>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Guidance Card -->
    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Guidance</h5>
            <ul class="text-muted">
                <li>Use the "Submit New Claim" button to add claims for the current month.</li>
                <li>Upload supporting documents directly from the dashboard using the "Upload" button next to each claim, or click the "Upload Supporting Document" button to navigate and select a claim.</li>
                <li>Track the status of your claims using the progress bar and status badges.</li>
                <li>Ensure all documents are in allowed formats: .pdf, .docx, .xlsx.</li>
            </ul>
        </div>
    </div>
</div>